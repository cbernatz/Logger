<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="378984296211-oalrj85dhm067v4jsulkdv5pi6ibq2u2.apps.googleusercontent.com">
    <link rel="stylesheet" href="styles.css">
    <title>Logger</title>
</head>
<body>
    <script src="https://apis.google.com/js/api.js"></script>
    <div class="padding"></div>
    <button class="btn" id="signOutBtn" onclick="signOut();">Sign out</button>

    <form action="#" onsubmit="foo(); return false">
        <input class="formEntry" type="text" id="EnteredBy" placeholder="Entered by">
        <br>
        <input class="formEntry" type="text" id="Medium" placeholder="Medium">
        <br>
        <input class="formEntry" type="text" id="ChannelCategory" placeholder="Channel Category">
        <br>
        <input class="formEntry" type="text" id="Channel" placeholder="Channel">
        <br>
        <input class="formEntry" type="text" id="ChannelSplit" placeholder="Channel Split">
        <br>
        <input class="formEntry" type="text" id="Partner" placeholder="Partner">
        <br>
        <input class="formEntry" type="text" id="CampaignType" placeholder="Campaign Type">
        <br>
        <input class="btn" type="submit" value="Submit"/>

    </form>

    <table id="myTable">
        <thead>
            <tr>
                <th>Entered By</th>
                <th>Medium</th>
                <th>Channel Category</th>
                <th>Channel</th>
                <th>Channel Split</th>
                <th>Partner</th>
                <th>Campaign Type</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>

    <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: "AIzaSyD2Yz0n4P5MrXGvHXpYiCDsMmEZpc813MM",
        authDomain: "logger-b2a2b.firebaseapp.com",
        projectId: "logger-b2a2b",
        storageBucket: "logger-b2a2b.appspot.com",
        messagingSenderId: "378984296211",
        appId: "1:378984296211:web:4f6b82de59d8e5e6fb74e6",
        measurementId: "G-3N4QL6GNSF"
     };
    // // Initialize Firebase
    // firebase.initializeApp(firebaseConfig);
    // firebase.analytics();
    </script>
    <script>
        // const firebase = require("firebase");
        // // Required for side-effects
        // require("firebase/firestore");
        // // Initialize Cloud Firestore through Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyD2Yz0n4P5MrXGvHXpYiCDsMmEZpc813MM",
            authDomain: "logger-b2a2b.firebaseapp.com",
            projectId: "logger-b2a2b",
        });

        var db = firebase.firestore();
        
        function foo() {
            Swal.fire(
            'Good job!',
            'You have submitted the expense',
            'success'
            )
            db.collection("expenses").add({
            enteredBy: document.getElementById("EnteredBy").value,
            medium: document.getElementById("Medium").value,
            channelCategory: document.getElementById("ChannelCategory").value,
            channel: document.getElementById("Channel").value,
            channelSplit: document.getElementById("ChannelSplit").value,
            partner: document.getElementById("Partner").value,
            campaignType: document.getElementById("CampaignType").value
            })
            .then((docRef) => {
                console.log("Document written with ID: ", docRef.id);
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
            });
        }

        console.log("HERE")
        db.collection("expenses").get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
                // doc.data() is never undefined for query doc snapshots
                console.log(doc.id, " => ", doc.data());
                var tbodyRef = document.getElementById('myTable').getElementsByTagName('tbody')[0];

                // Insert a row at the end of table
                var newRow = tbodyRef.insertRow();

                // Insert a cell at the end of the row
                var newCell = newRow.insertCell();

                // Append a text node to the cell
                var newText = document.createTextNode(doc.data().enteredBy);
                newCell.appendChild(newText);

                // Insert a cell at the end of the row
                var newCell1 = newRow.insertCell();

                // Append a text node to the cell
                var newText1 = document.createTextNode(doc.data().medium);
                newCell1.appendChild(newText1);

                // Insert a cell at the end of the row
                var newCell2 = newRow.insertCell();

                // Append a text node to the cell
                var newText2 = document.createTextNode(doc.data().channelCategory);
                newCell2.appendChild(newText2);
                
                // Insert a cell at the end of the row
                var newCell3 = newRow.insertCell();

                // Append a text node to the cell
                var newText3 = document.createTextNode(doc.data().channel);
                newCell3.appendChild(newText3);
                
                // Insert a cell at the end of the row
                var newCell4 = newRow.insertCell();

                // Append a text node to the cell
                var newText4 = document.createTextNode(doc.data().channelSplit);
                newCell4.appendChild(newText4);
                
                // Insert a cell at the end of the row
                var newCell5 = newRow.insertCell();

                // Append a text node to the cell
                var newText5 = document.createTextNode(doc.data().partner);
                newCell5.appendChild(newText5);
                
                var newCell6 = newRow.insertCell();

                // Append a text node to the cell
                var newText6 = document.createTextNode(doc.data().campaignType);
                newCell6.appendChild(newText6);

            });
        });

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            console.log('User signed out.');
            window.location = "index.html"
        })};

        function onLoad() {
            gapi.load('auth2', function() {
                gapi.auth2.init();
            });
            }

    </script>
    <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
</body>
</html>
